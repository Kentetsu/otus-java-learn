<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>CRM System - Clients</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-4">
  <h1>CRM System - Clients Management</h1>

  <div class="card mb-4">
    <div class="card-header">
      <h5>Create New Client</h5>
    </div>
    <div class="card-body">
      <form th:action="@{/clients}" th:object="${newClient}" method="post">
        <div class="mb-3">
          <label for="name" class="form-label">Client Name *</label>
          <input type="text" class="form-control" id="name" th:field="*{name}"
                 placeholder="Enter client name" required>
        </div>

        <div class="mb-3">
          <label for="street" class="form-label">Address</label>
          <input type="text" class="form-control" id="street" th:field="*{street}"
                 placeholder="Enter street address">
        </div>

        <div class="mb-3">
          <label class="form-label">Phone Numbers</label>
          <div id="phones-container">
            <div class="input-group mb-2 phone-input">
              <input type="text" class="form-control" th:name="phoneNumbers"
                     placeholder="Enter phone number">
              <button type="button" class="btn btn-outline-danger remove-phone" disabled>
                Remove
              </button>
            </div>
          </div>
          <button type="button" id="add-phone" class="btn btn-outline-secondary btn-sm">
            Add Another Phone
          </button>
        </div>

        <button type="submit" class="btn btn-primary">Create Client</button>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h5>All Clients</h5>
    </div>
    <div class="card-body">
      <div th:if="${clients.empty}">
        <p class="text-muted">No clients found.</p>
      </div>
      <div th:unless="${clients.empty}">
        <table class="table table-striped">
          <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Address</th>
            <th>Phones</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="client : ${clients}">
            <td th:text="${client.id}">ID</td>
            <td th:text="${client.name}">Name</td>
            <td>
              <span th:if="${client.address != null}"
                    th:text="${client.address.street}">Street</span>
              <span th:unless="${client.address != null}"
                    class="text-muted">No address</span>
            </td>
            <td>
              <span th:if="${client.phones != null and !client.phones.empty}">
                <span th:each="phone, iterStat : ${client.phones}">
                  <span th:text="${phone.number}"></span>
                  <span th:unless="${iterStat.last}">, </span>
                </span>
              </span>
              <span th:unless="${client.phones != null and !client.phones.empty}"
                    class="text-muted">No phones</span>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  $(document).ready(function() {
      $('#add-phone').click(function() {
          var newPhoneInput = $('.phone-input').first().clone();
          newPhoneInput.find('input').val('');
          newPhoneInput.find('.remove-phone').prop('disabled', false);
          $('#phones-container').append(newPhoneInput);
      });

      $(document).on('click', '.remove-phone', function() {
          if ($('.phone-input').length > 1) {
              $(this).closest('.phone-input').remove();
          }

          if ($('.phone-input').length === 1) {
              $('.remove-phone').prop('disabled', true);
          }
      });
  });
</script>
</body>
</html>